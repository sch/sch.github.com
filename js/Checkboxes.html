<div ref:element class="CheckboxCanvas">
  {{#each canvas as row, rowIndex}}
  <div>
    {{#each row as column, columnIndex}}
    <label>
      <input type="checkbox" checked={{column}} />
    </label>
    {{/each}}
  </div>
  {{/each}}
</div>

<style>
.CheckboxCanvas {
  box-sizing: border-box;
  overflow: hidden;
  margin-bottom: 1em;
}

.CheckboxCanvas div {
  margin: 0;
  line-height: 0;
}

.CheckboxCanvas label {
  padding: 1px;
  display: inline-block;
}

.CheckboxCanvas input {
  margin: 0;
  padding: 0;
}
</style>

<script>
import { drawText, emptyCanvas, createPoint, flipBit } from "./canvas"
import { randomWalk, Point, Dimensions } from "./graphics"
import throttle from "lodash.throttle"

const CHECKBOX_SIZE = 14

function scale (pixelSize) {
  return Math.floor(pixelSize / CHECKBOX_SIZE)
}

function getDimensions (element) {
  return {
    width: scale(element.clientWidth),
    height: scale(window.innerHeight) - 6,
  }
}

function randomInRange (upperLimit) {
  return Math.floor(Math.random() * upperLimit)
}

export default {
  data: function () {
    return {
      width: 200,
      height: 100,
      point: new Point(20, 20),
      text: "adrian schaedle"
    }
  },

  onrender: function () {
    window.addEventListener("resize", this.resize.bind(this))
    setInterval(this.tick.bind(this), 1000)
    this.resize()
  },

  onteardown: function () {
    window.removeEventListener("resize", this.resize)
  },

  computed: {
    canvas: function (width, height, text, point) {
      var canvas = emptyCanvas(width, height)
      canvas = drawText(canvas, "adrian", createPoint(2, 2))
      canvas = drawText(canvas, "schaedle", createPoint(2, 9))
      flipBit(canvas, point.x, point.y)
      return canvas
    }
  },

  methods: {
    resize: throttle(function () {
      this.set(getDimensions(this.refs.element))
    }, 500),

    tick () {
      var point = this.get("point")
      var dimensions = new Dimensions(this.get("width"), this.get("height"))
      this.set({ point: randomWalk(point, dimensions) })
    }
  }
}
</script>
